
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>For You ‚ú®</title>
    <style>
        body, html {
            margin: 0; padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: 'Georgia', serif;
            overflow: hidden;
            text-align: center;
            
            /* bg */
            background: url('step3_bg.jpg') no-repeat center center fixed;
            background-size: cover; 
        }

        /* Overlay to darken the background */
        .bg-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.4);
            z-index: 1;
        }

        #container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(5px);
            padding: 40px;
            border-radius: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            max-width: 500px;
            width: 85%;
            z-index: 10;
            position: relative;
            transition: all 0.5s ease;

            /* --- SCROLL FIX FOR MISSING BUTTON --- */
            max-height: 80vh;       /* limit height */
            overflow-y: auto;       /* enable scrolling */
            scrollbar-width: none;  /* hide scrollbar (Firefox) */
        }

        /* Hide scrollbar for Chrome/Safari/Phones */
        #container::-webkit-scrollbar { 
            display: none; 
        }

        .step { display: none; animation: fadeIn 1s ease-in-out; }
        .active { display: block; }

        h2 { color: #ff4d6d; font-size: 1.8em; margin-bottom: 20px; }
        p { color: #333; line-height: 1.8; font-size: 1.1em; font-weight: 500; }

        .btn-next {
            background: #ff4d6d;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            margin-top: 20px;
            font-size: 1em;
            transition: transform 0.2s;
        }
        .btn-next:hover { transform: scale(1.05); }

        /* Timeline Styles */
        .timeline {
            display: flex;
            overflow-x: auto;
            gap: 15px;
            padding: 20px 0;
            scrollbar-width: none;
        }
        .timeline-item {
            min-width: 200px;
            height: 250px;
            background: #eee;
            border-radius: 15px;
            overflow: hidden;
            flex-shrink: 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .timeline-item img { width: 100%; height: 100%; object-fit: cover; }

        .game-container {
            position: relative;
            height: 150px;
            margin-top: 20px;
            overflow: hidden; /* prevents page jump */
        }

        #yesBtn { background: #ff4d6d; color: white; border: none; padding: 15px 35px; border-radius: 50px; font-weight: bold; cursor: pointer; font-size: 1.2em; }
        #noBtn {
            background: #adb5bd;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 50px;
            position: absolute;              /* CHANGED */
            cursor: pointer;
            white-space: nowrap;
            left: 60%;
            top: 70%;
            transform: translate(-50%, -50%);
            transition: all 0.25s ease;       /* smooth dodge */
        }


        .bouquet { font-size: 100px; margin-bottom: 10px; }

        /* NOTEBOOK TYPEWRITER EFFECT */
        .notebook-container {
            background: linear-gradient(180deg, #fef9e7 0%, #f5f0dc 100%);
            border: 2px solid #e0d8b0;
            border-radius: 15px;
            padding: 25px;
            margin: 15px 0;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.05);
        }

        .notebook-lines {
            position: absolute;
            top: 0; left: 30px; right: 0; bottom: 0;
            background-image: 
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 24px,
                    #e8e3d0 24px,
                    #e8e3d0 25px
                );
            pointer-events: none;
            z-index: 1;
        }

        .notebook-text {
            position: relative;
            z-index: 2;
            min-height: 120px;
            /* Updated Font */
            font-family: 'Caveat', cursive; 
            font-size: 1.4em; /* Handwriting fonts usually need to be slightly larger to be readable */
            line-height: 1.6;
            color: #2c1810;
            letter-spacing: 0.5px;
        }

        .typewriter-text {
            display: inline-block;
            border-right: 2px solid #4a2c0b;
            animation: blink-cursor 1s infinite;
            white-space: pre-wrap;
            /* Ensure this matches the parent */
            font-family: 'Caveat', cursive;
        }
        /* Enhanced Memory Gallery */
.memory-gallery {
    display: flex;
    overflow-x: auto;
    gap: 20px;
    padding: 20px 10px;
    scroll-snap-type: x mandatory; /* Makes cards snap into view */
    scrollbar-width: none;
    -webkit-overflow-scrolling: touch;
}

.memory-card {
    min-width: 260px;
    background: white;
    padding: 12px;
    padding-bottom: 20px;
    border-radius: 15px;
    box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    scroll-snap-align: center;
    transform: rotate(calc(var(--r, 0deg))); /* Adds a slight random tilt */
    transition: transform 0.3s ease;
}

.memory-card:hover {
    transform: rotate(0deg) scale(1.02);
}

.memory-card img {
    width: 100%;
    height: 200px;
    object-fit: cover;
    border-radius: 10px;
    margin-bottom: 12px;
}

.caption {
    font-family: 'Georgia', serif;
    font-size: 0.95em;
    color: #555;
    font-style: italic;
    line-height: 1.4;
    padding: 0 5px;
}

/* Indicators to show there's more to scroll */
.scroll-hint {
    font-size: 0.8em;
    color: #ff4d6d;
    margin-top: 10px;
    animation: bounce 2s infinite;
}

@keyframes bounce {
    0%, 20%, 50%, 80%, 100% {transform: translateX(0);}
    40% {transform: translateX(-5px);}
    60% {transform: translateX(5px);}
}

        @keyframes blink-cursor {
            0%, 50% { border-right-color: #4a2c0b; }
            51%, 100% { border-right-color: transparent; }
        }

        .typewriter-complete {
            border-right: none !important;
            animation: none !important;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .floating-item { position: absolute; opacity: 0.3; z-index: 2; animation: float 8s infinite linear; pointer-events: none; color: white; text-shadow: 0 0 5px #ff4d6d; }
        @keyframes float { 0% { transform: translateY(0) rotate(0); } 100% { transform: translateY(-100vh) rotate(360deg); } }

        #canvas { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 15; }
    </style>
</head>
<body>

    <audio id="bgMusic" loop><source src="ks.mp3" type="audio/mpeg"></audio>
    <audio id="successMusic"><source src="if.mp3" type="audio/mpeg"></audio>
    <audio id="finalMusic" loop><source src="final.mp3" type="audio/mpeg"></audio>

    <div class="bg-overlay"></div>
    <canvas id="canvas"></canvas>

    <div class="floating-item" style="left: 5%; bottom: 0; font-size: 40px;">üå∏</div>
    <div class="floating-item" style="left: 25%; bottom: -10%; font-size: 30px; animation-delay: 2s;">üìñ</div>
    <div class="floating-item" style="right: 15%; bottom: -20%; font-size: 50px; animation-delay: 4s;">üíù</div>
    <div class="floating-item" style="right: 5%; bottom: 0; font-size: 35px; animation-delay: 1s;">‚ú®</div>

    <div id="container">
        <div id="step1" class="step active">
            <h2>Hey Aanya... ‚ú®</h2>
            <p>I‚Äôve built something special to tell you what's on mind.<br>Before we start, make sure your volume is up! üéµ</p>
            <button class="btn-next" onclick="startExperience()">Open My Message</button>
        </div>

        <div id="step2" class="step">
            <h2 style="color: #ff4d6d;">The Day...</h2>
            <div class="notebook-container">
                <div class="notebook-lines"></div>
                <div class="notebook-text">
                    <span class="typewriter-text" data-text=""></span> 

                </div>
            </div>
            <button class="btn-next" onclick="nextStep(3)">Click to continue...</button>
        </div>

        <div id="step3" class="step">
            <h2 style="color: #ff4d6d;">How I see You..</h2>
            <div class="notebook-container">
                <div class="notebook-lines"></div>
                <div class="notebook-text">
                    <span class="typewriter-text" data-text=""></span>

                </div>
            </div>
            <button class="btn-next" onclick="nextStep(4)">See our journey...</button>
        </div>

        <div id="step4" class="step">
            <h2>Moments We Shared ‚ú®</h2>
            <p>Every small memory with you is a big deal to me.</p>
            
            <div class="memory-gallery">
                <div class="memory-card" style="--r: -2deg;">
                    <img src="photo1.jpg" alt="">
                    <div class="caption"></div>
                </div>

                <div class="memory-card" style="--r: 3deg;">
                    <img src="photo2.jpg" alt="">
                    <div class="caption"></div>
                </div>

                <div class="memory-card" style="--r: -1deg;">
                    <img src="photo3.jpg" alt="">
                    <div class="caption"></div>
                </div>

                <div class="memory-card" style="--r: 2deg;">
                    <img src="photo4.jpg" alt="">
                    <div class="caption"></div>
                </div>.

                <div class="memory-card" style="--r: -3deg;">
                    <img src="photo5.jpg" alt="">
                    <div class="caption"></div>
                </div>

                <div class="memory-card" style="--r: 1deg;">
                    <img src="photo6.jpg" alt="">
                    <div class="caption"></div>
                </div>

                <div class="memory-card" style="--r: -2deg;">
                    <img src="photo7.jpg" alt="">
                    <div class="caption"></div>
                </div>

                <div class="memory-card" style="--r: 4deg;">
                    <img src="photo8.jpg" alt="">
                    <div class="caption"></div>
                </div>
            </div>

            <div class="scroll-hint">Swipe to see more ‚Üí</div>
            <button class="btn-next" onclick="nextStep(5)">One more thing...</button>
        </div>

            <div id="step5" class="step">
                <h2>The Big Question</h2>
                <p></p>
                <div class="game-container">
                    <button id="yesBtn" onclick="celebrate()">YES! ‚ù§Ô∏è</button>
                    <button id="noBtn" onmouseover="moveNo()">No</button>
                </div>
            </div>

        <div id="step6" class="step">
            <div class="bouquet">üíê</div>
            <h2>I knew it! ‚ù§Ô∏è</h2>
            <p>The deal is finalized, Aanya üòâ</p>
            <p><b></b></p>
            <button class="btn-next" onclick="showSurprise()">Click for one last surprise...</button>
        </div>
    </div>

    <script>
        let noCount = 0;
        const bgMusic = document.getElementById('bgMusic');
        const successMusic = document.getElementById('successMusic');
        const finalMusic = document.getElementById('finalMusic');
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");

        // HEART TEXT MESSAGES
        const HEART_MESSAGES = [
            "I love you Aanya ‚ù§Ô∏è",
            "I will always be yours",
        ];

        function startExperience() {
            bgMusic.play().catch(e => console.log("Music play blocked by browser until interaction"));
            nextStep(2);
        }

        function nextStep(stepNum) {
            document.querySelectorAll('.step').forEach(step => step.classList.remove('active'));
            document.getElementById('step' + stepNum).classList.add('active');
            
            // Trigger typewriter ONLY if we are on step 2 or 3
            if (stepNum === 2 || stepNum === 3) {
                setTimeout(initTypewriter, 500);
            }
        }

        function celebrate() {
            bgMusic.pause();
            successMusic.play();
            nextStep(6);
            launchHearts();
        }

        function showSurprise() {
            successMusic.pause();
            finalMusic.play().catch(e => console.log(e));
            document.getElementById('container').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('container').style.display = 'none';
                canvas.style.display = 'block';
                initParticles();
                animateParticles();
            }, 1000);
        }

        function moveNo() {
            const noBtn = document.getElementById('noBtn');
            const container = document.querySelector('.game-container');

            const maxX = container.clientWidth - noBtn.offsetWidth;
            const maxY = container.clientHeight - noBtn.offsetHeight;

            const x = Math.random() * maxX;
            const y = Math.random() * maxY;

            noBtn.style.left = x + 'px';
            noBtn.style.top = y + 'px';

            const messages = [
                "Think again üòè",
                "Nice try üòâ",
                "Wrong choice üò§",
                "Yes is better ‚ù§Ô∏è",
                "Nope üòÑ"
            ];

            noBtn.innerText = messages[noCount % messages.length];
            noCount++;
        }


        // --- FIXED TYPEWRITER LOGIC ---
        function initTypewriter() {
            // Find which step is currently active (Step 2 or Step 3)
            const activeStep = document.querySelector('.step.active');
            
            if (activeStep) {
                // Find the typewriter box ONLY inside that active step
                const typewriters = activeStep.querySelectorAll('.typewriter-text[data-text]');
                
                typewriters.forEach((el, index) => {
                    // Check if it's already done or started. If text is empty, start it.
                    if (!el.classList.contains('typewriter-complete') && el.textContent === "") {
                        setTimeout(() => {
                            // Speed set to 40ms for slightly faster typing
                            typeWriter(el, el.getAttribute('data-text'), 0, 40); 
                        }, index * 500);
                    }
                });
            }
        }

        function typeWriter(element, text, i, speed) {
            if (i < text.length) {
                element.textContent = text.substring(0, i + 1);
                // Scroll to bottom of container as it types
                const container = document.getElementById('container');
                container.scrollTop = container.scrollHeight;
                
                setTimeout(() => typeWriter(element, text, i + 1, speed), speed + Math.random() * 20);
            } else {
                element.classList.add('typewriter-complete');
            }
        }

        // ENHANCED CYCLING PARTICLE ENGINE
        let particles = [];
        let currentMessageIndex = 0;
        const MESSAGES = [
            "I love you, Aanya",
            "Can you give me a chance?", 
            "You are beautiful by heart"
        ];
        let cycleState = 'forming';
        let cycleTimer = 0;
        let textPixels = [];
        let exploded = false;
        const CYCLE_DURATION = 4000;

        window.addEventListener('mousedown', () => {
            exploded = true;
            cycleState = 'exploding';
            setTimeout(() => { exploded = false; }, 2500);
        });

        class Particle {
            constructor(targetX, targetY, isText = false) {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.baseX = targetX;
                this.baseY = targetY;
                this.vx = (Math.random() - 0.5) * 25;
                this.vy = (Math.random() - 0.5) * 25;
                this.acc = isText ? 0.15 : 0.08;
                this.friction = 0.92;
                this.size = isText ? Math.random() * 2 + 1.2 : Math.random() * 1 + 0.5;
                this.color = isText ? "#ffffff" : "#ff1a4d";
                this.isText = isText;
            }
            update() {
                if (exploded || cycleState === 'exploding') {
                    this.x += this.vx; this.y += this.vy;
                    this.vx *= this.friction; this.vy *= this.friction;
                } else {
                    let dx = this.baseX - this.x;
                    let dy = this.baseY - this.y;
                    this.x += dx * this.acc; this.y += dy * this.acc;
                    this.vx = (Math.random() - 0.5) * 30;
                    this.vy = (Math.random() - 0.5) * 30;
                }
                this.x += Math.sin(Date.now() * 0.002 + this.baseX) * 0.3;
                this.y += Math.cos(Date.now() * 0.002 + this.baseY) * 0.3;
            }
            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                if(this.isText) { ctx.shadowBlur = 15; ctx.shadowColor = "#ff80bf"; }
                else { ctx.shadowBlur = 2; ctx.shadowColor = "#ff1a4d"; }
                ctx.fill();
                ctx.shadowBlur = 0;
            }
        }

        function generateTextPixels(message) {
            const textCanvas = document.createElement('canvas');
            const tCtx = textCanvas.getContext('2d');
            textCanvas.width = canvas.width; textCanvas.height = canvas.height;
            tCtx.fillStyle = 'white';
            tCtx.font = '900 65px Arial'; 
            tCtx.textAlign = 'center';
            tCtx.textBaseline = 'middle';
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            tCtx.fillText(message, centerX, centerY);
            
            const pixels = tCtx.getImageData(0, 0, canvas.width, canvas.height).data;
            const targets = [];
            for (let y = 0; y < canvas.height; y += 3) {
                for (let x = 0; x < canvas.width; x += 3) {
                    if (pixels[(y * canvas.width + x) * 4] > 128) targets.push({x, y});
                }
            }
            return targets;
        }

        function initParticles() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            particles = [];
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;

            textPixels = generateTextPixels(MESSAGES[currentMessageIndex]);
            const PARTICLE_COUNT = Math.min(8000, textPixels.length * 3);
            
            for (let i = 0; i < PARTICLE_COUNT; i++) {
                if (i < textPixels.length) {
                    particles.push(new Particle(textPixels[i].x, textPixels[i].y, true));
                } else {
                    const t = Math.random() * Math.PI * 2;
                    const r = 0.3 + Math.random() * 0.7; 
                    const x = 16 * Math.pow(Math.sin(t), 3);
                    const y = 13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t);
                    particles.push(new Particle(centerX + x * 18 * r, centerY - y * 18 * r, false));
                }
            }
            cycleState = 'forming';
            cycleTimer = 0;
        }

        function animateParticles() {
            ctx.fillStyle = "rgba(0, 0, 0, 0.25)"; 
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            if (!exploded) {
                cycleTimer++;
                if (cycleState === 'holding' && cycleTimer > CYCLE_DURATION) {
                    cycleState = 'exploding';
                    cycleTimer = 0;
                } else if (cycleState === 'exploding' && cycleTimer > CYCLE_DURATION / 2) {
                    currentMessageIndex = (currentMessageIndex + 1) % MESSAGES.length;
                    textPixels = generateTextPixels(MESSAGES[currentMessageIndex]);
                    particles.forEach((p, i) => {
                        if (i < textPixels.length) {
                            p.baseX = textPixels[i].x;
                            p.baseY = textPixels[i].y;
                            p.isText = true;
                        }
                    });
                    cycleState = 'forming';
                    cycleTimer = 0;
                } else if (cycleState === 'forming' && cycleTimer > CYCLE_DURATION * 1.5) {
                    cycleState = 'holding';
                    cycleTimer = 0;
                }
            }
            
            particles.forEach(p => { p.update(); p.draw(); });
            requestAnimationFrame(animateParticles);
        }

        function launchHearts() {
            for(let i = 0; i < 30; i++) {
                setTimeout(() => {
                    const heart = document.createElement('div');
                    const messageIndex = Math.floor(Math.random() * HEART_MESSAGES.length);
                    heart.innerHTML = `<span style="font-size: 12px; line-height: 1.2; display: block; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); white-space: nowrap; opacity: 0.9;">${HEART_MESSAGES[messageIndex]}</span>‚ù§Ô∏è`;
                    heart.style.cssText = `
                        position: fixed;
                        left: ${Math.random() * 100}vw;
                        top: 100vh;
                        font-size: 25px;
                        z-index: 100;
                        pointer-events: none;
                        transition: all 5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                        transform: translateX(0, 0);
                        opacity: 1;
                    `;
                    document.body.appendChild(heart);
                    
                    setTimeout(() => {
                        const randomX = (Math.random() - 0.5) * 200;
                        heart.style.transform = `translateY(-130vh) translateX(${randomX}px) rotate(${Math.random() * 20 - 10}deg) scale(1.2)`;
                        heart.style.opacity = '0';
                    }, 200 + i * 50);
                    
                    setTimeout(() => {
                        if (heart.parentNode) heart.remove();
                    }, 5200 + i * 50);
                }, i * 100);
            }
        }
        /* üîÅ AUTO CYCLE: explode ‚Üí reform (CHANGE 2) */
setInterval(() => {
    // Force explode
    exploded = true;
    cycleState = 'exploding';
    cycleTimer = 0;

    // Reform after explosion
    setTimeout(() => {
        exploded = false;
        cycleState = 'forming';
        cycleTimer = 0;
    }, 2200);

}, 7000); // every 7 seconds

    </script>
</body>
</html>
